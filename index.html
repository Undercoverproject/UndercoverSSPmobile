<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Undercover SSP - Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    :root{
      --accent:#2bb673;
      --accent-dark:#1e8f56;
      --bg-dark:#02140a;
      --text:#f6f9fb;
      --card-bg: rgba(255,255,255,0.05);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color:var(--text);
      background: var(--bg-dark); /* Couleur de fond si l'anim charge pas */
      min-height:100vh;
      overflow-x: hidden;
    }
    
    /* Le conteneur pour la fum√©e */
    #vanta-bg { position:fixed; inset:0; z-index:0; }
    
    .overlay { 
      position:relative; z-index:2; min-height:100vh;
      background: linear-gradient(180deg, rgba(0,10,6,0.3), rgba(0,0,0,0.6)); /* Transparence pour voir la fum√©e */
      padding:15px; 
      display:flex; flex-direction:column; align-items:center; 
    }
    
    .container { width:100%; max-width:600px; padding-bottom: 40px; }
    
    header{ 
      display:flex; flex-direction:column; align-items:center; gap:5px; margin-bottom:20px; 
      text-align:center;
    }
    h1{ margin:0; font-size:26px; color: #4ade80; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
    p.lead{ margin:0; opacity:0.9; font-size:14px; }
    
    /* Navigation Mobile */
    .btn{ 
      background:linear-gradient(180deg,var(--accent),var(--accent-dark)); 
      color:white; padding:14px 20px; border-radius:12px; border:none; 
      cursor:pointer; font-size:16px; font-weight:600;
      touch-action: manipulation;
      transition: transform 0.1s;
      width:100%; margin-bottom:10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    .btn:active { transform: scale(0.96); }
    .btn.ghost{ background: rgba(255,255,255,0.1); color:var(--text); border:1px solid rgba(255,255,255,0.1); backdrop-filter: blur(4px); }
    .btn.danger{ background: #e74c3c; }

    /* Cards (Translucides pour voir la fum√©e) */
    .card{ 
      background: rgba(20, 30, 25, 0.65); 
      border-radius:16px; padding:20px; margin-bottom:15px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.4); 
      border:1px solid rgba(255,255,255,0.08); 
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    
    .screen{ display:none; }
    .screen.active{ display:block; animation:fadeIn .3s ease; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }
    
    /* Inputs Mobile */
    label { font-weight: 700; display:block; margin-bottom: 8px; font-size:14px; color:#8fe7a8; }
    select, input[type="text"], input[type="number"] { 
      width:100%; padding:14px; border-radius:12px; 
      border:1px solid rgba(255,255,255,0.2); font-size:16px; 
      background: rgba(0,0,0,0.4); color:white; margin-bottom: 15px; 
      appearance: none;
    }
    
    /* Dictionnaire Styles */
    .dict-category { 
        margin-top: 25px; border-bottom: 2px solid var(--accent); 
        padding-bottom: 5px; color: var(--accent); 
        font-size: 1.1em; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
    }
    .dict-theme { margin-top: 15px; color: #fff; font-weight: bold; font-size: 1.05em; margin-bottom:5px;}
    .dict-item { 
        background: rgba(255,255,255,0.07); 
        margin-bottom: 10px; padding: 12px; border-radius: 10px; 
        border-left: 3px solid rgba(255,255,255,0.3);
    }
    .dict-pair { font-weight: 700; color: #4ade80; margin-bottom: 6px; font-size:1.1em; }
    .dict-def { font-size: 0.95em; opacity: 0.9; line-height: 1.4; color: #ddd; }

    /* Jeu */
    #wordDisplay{ font-size:32px; font-weight:800; padding:20px; border-radius:12px; display:inline-block; margin-top:10px; background: rgba(255,255,255,0.1); color: #4ade80; width:100%; text-align:center; border: 1px solid rgba(74, 222, 128, 0.3); }
    .vote-item{ background: rgba(255,255,255,0.05); padding:15px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; font-size:18px; margin-bottom: 8px; cursor: pointer; border:1px solid transparent;}
    .vote-item.selected { border-color: var(--accent); background: rgba(43,182,115,0.2); }
    
    .timer{ font-size:48px; font-weight:800; display:block; text-align:center; margin:15px 0; letter-spacing:2px; font-variant-numeric: tabular-nums; }
    
    .role-check { display:flex; align-items:center; gap:12px; padding:12px; background:rgba(255,255,255,0.05); margin-bottom:8px; border-radius:8px; }
    .role-check input { width:20px; height:20px; margin:0; }
  </style>
</head>
<body>
  <div id="vanta-bg"></div>

  <div class="overlay">
    <div class="container">
      <header>
        <h1>üå± Undercover SSP</h1>
        <p class="lead">Apprentissage Sites & Sols Pollu√©s</p>
      </header>

      <main>
        <section id="menu" class="screen active">
          <div class="card">
            <h2 style="text-align:center; margin-top:0;">Menu</h2>
            <nav style="flex-direction:column;">
              <button class="btn" onclick="show('configScreen')">üéÆ Nouvelle Partie</button>
              <button class="btn ghost" onclick="show('dictionaryScreen')">üìö Dictionnaire</button>
              <button class="btn ghost" onclick="show('explainScreen')">‚ùì R√®gles</button>
            </nav>
          </div>
        </section>

        <section id="configScreen" class="screen">
          <div class="card">
            <h2>‚öôÔ∏è Configuration</h2>
            
            <label>1. Difficult√©</label>
            <select id="difficultySelect" onchange="updateThemes()">
              <option value="facile">üü¢ Facile</option>
              <option value="moyen">üü° Moyen</option>
              <option value="difficile">üî¥ Difficile</option>
            </select>

            <label>2. Sous-th√®me</label>
            <select id="themeSelect"></select>

            <label>3. Joueurs</label>
            <input id="playerCount" type="number" min="3" max="20" value="5" onchange="buildNameInputs()" />

            <div id="namesList" style="max-height:200px; overflow-y:auto; margin-bottom:15px;"></div>
            
            <div style="text-align:center;">
                <button class="btn ghost" style="font-size:14px; padding:10px;" onclick="document.getElementById('rolesOptions').style.display='block'; this.style.display='none'">+ Options R√¥les</button>
            </div>

            <div id="rolesOptions" style="display:none; margin-top:15px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
                <label>R√¥les Sp√©ciaux</label>
                <div id="rolesSelect"></div>
            </div>

            <button class="btn" style="margin-top:20px;" onclick="assignRolesAndWords()">‚ñ∂Ô∏è Lancer</button>
            <button class="btn ghost" onclick="show('menu')">Retour</button>
          </div>
        </section>

        <section id="dictionaryScreen" class="screen">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2 style="margin:0;">üìö Dictionnaire</h2>
                    <button class="btn ghost" style="padding:5px 10px; width:auto; margin:0;" onclick="show('menu')">‚úï</button>
                </div>
                
                <div id="dictionaryContent" style="max-height: 70vh; overflow-y: auto; padding-right: 5px; margin-top:15px;">
                    </div>
            </div>
        </section>

        <section id="revealScreen" class="screen">
          <div class="card" style="text-align:center;">
            <h2>üîí Distribution</h2>
            <p style="font-size:14px; opacity:0.8;">Passez le t√©l√©phone au joueur indiqu√©.</p>
            
            <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:12px; margin:20px 0;">
                <h3 id="revealName" style="margin:0; font-size:24px; color:var(--accent);">Joueur X</h3>
            </div>

            <button class="btn" id="seeBtn" onclick="seeMyWord()">üëÅÔ∏è Voir mon mot</button>

            <div id="wordInfo" style="display:none;">
              <div id="wordDisplay">MOT</div>
              <div id="roleLabel" style="margin-top:15px; font-weight:bold; color:#f1c40f;"></div>
              
              <div style="margin-top:20px; margin-bottom:20px; font-size:14px; opacity:0.8;">
                  M√©morise ton mot et clique pour cacher.
              </div>
              
              <button class="btn ghost" onclick="nextReveal()">Cacher & Suivant ‚û°Ô∏è</button>
            </div>
          </div>
        </section>

        <section id="discussionScreen" class="screen">
          <div class="card">
            <div id="publicRoleBanner" style="background:#e67e22; padding:10px; border-radius:8px; margin-bottom:15px; text-align:center; font-weight:bold; display:none;"></div>

            <h2 style="text-align:center; margin-top:0;">üó£Ô∏è D√©bat</h2>
            <div class="timer" id="timerDisplay">01:30</div>
            
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="startDiscussion()">Start</button>
                <button class="btn ghost" onclick="if(confirm('Passer au vote ?')) openVoting()">Vote</button>
            </div>

            <div id="votingArea" style="margin-top:25px; display:none; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">
              <h3>üó≥Ô∏è Vote</h3>
              <p style="font-size:14px;">Touchez le nom pour s√©lectionner.</p>
              <div id="voteList"></div>
              <button class="btn danger" onclick="collectVotes()">Confirmer √âlimination üíÄ</button>
            </div>
          </div>
        </section>

        <section id="afterScreen" class="screen">
          <div class="card" style="text-align:center;">
            <h2>R√©sultat</h2>
            <div id="afterContent" style="font-size:18px; margin:20px 0; line-height:1.5;"></div>
            <button class="btn" onclick="proceedAfterVote()">Tour Suivant</button>
            <button class="btn ghost" onclick="forceFinalReveal()">Arr√™ter Partie</button>
          </div>
        </section>

        <section id="endScreen" class="screen">
          <div class="card" style="text-align:center;">
            <h2>üèÅ Fin de Partie</h2>
            <div id="endMessage" style="font-size:20px; font-weight:bold; color:var(--accent); margin-bottom:20px;"></div>

            <div style="text-align:left; background:rgba(255,255,255,0.05); padding:15px; border-radius:10px;">
                <p style="margin:5px 0;">üìú <strong>L'Explication Technique :</strong></p>
                <div id="endContext" style="font-style:italic; color:#ddd; margin-top:5px;"></div>
            </div>

            <div style="margin-top:20px; text-align:left;">
                <h4>Les R√¥les √©taient :</h4>
                <ul id="playersSummary" style="list-style:none; padding:0;"></ul>
            </div>

            <button class="btn" onclick="location.reload()">Rejouer</button>
            <button class="btn ghost" onclick="show('menu')">Menu</button>
          </div>
        </section>

        <section id="explainScreen" class="screen">
            <div class="card">
                <h2>R√®gles Rapides</h2>
                <ul>
                    <li><strong>Civils :</strong> Mot identique. Doivent tuer l'intrus.</li>
                    <li><strong>Pollueur :</strong> Mot l√©g√®rement diff√©rent. Doit survivre.</li>
                    <li><strong>Mister White :</strong> Aucun mot. Doit deviner le mot des civils.</li>
                </ul>
                <button class="btn" onclick="show('menu')">Retour</button>
            </div>
        </section>

      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>

  <script>
    /* INIT VANTA */
    window.onload = function() {
        try {
            VANTA.FOG({
                el: "#vanta-bg",
                mouseControls: true, touchControls: true, gyroControls: false,
                minHeight: 200.00, minWidth: 200.00,
                highlightColor: 0x8fe7a8, midtoneColor: 0x2bb673, lowlightColor: 0x08351a, baseColor: 0x02140a,
                blurFactor: 0.6, speed: 0.8
            });
        } catch(e){}
        
        updateThemes();
        buildNameInputs();
        renderDictionary();
        populateRoles();
    };

    /* DONNEES */
    const GAME_DATA = {
      facile: {
        "Concepts de pollution": [
          [["D√©pollution", "D√©contamination"], "La d√©pollution √©limine/r√©duit la pollution. La d√©contamination retire des agents dangereux (plus sp√©cifique)."],
          [["Pollution", "Contamination"], "La pollution est une d√©gradation globale. La contamination est une pr√©sence locale ind√©sirable."],
          [["Risque", "Danger"], "Le danger est intrinseque. Le risque est la probabilit√© que le danger cause un dommage (d√©pend de l'exposition)."]
        ],
        "√âtudes & analyses": [
          [["√âtude", "Rapport"], "L'√©tude est l'action d'analyser. Le rapport est le document papier qui en r√©sulte."],
          [["Pr√©l√®vement", "√âchantillon"], "Le pr√©l√®vement est l'action de prendre. L'√©chantillon est la mati√®re collect√©e."],
          [["Sable", "Charbon actif"], "Le sable filtre m√©caniquement (particules). Le charbon absorbe chimiquement (polluants dissous)."],
          [["Bassin", "R√©servoir"], "Un bassin est g√©n√©ralement ouvert (air libre). Un r√©servoir est souvent ferm√©."]
        ],
        "Hydrog√©ologie simple": [
          [["Pi√©zom√®tre", "Forage"], "Le forage est le trou. Le pi√©zom√®tre est l'√©quipement de mesure install√© DANS le forage."],
          [["Sable", "Gravier"], "Diff√©rence de taille (granulom√©trie). Le gravier est plus gros et laisse l'eau passer plus vite."],
          [["Eau potable", "Eau brute"], "L'eau brute est naturelle. L'eau potable a √©t√© trait√©e."],
          [["Source", "Fontaine"], "La source est naturelle. La fontaine est un am√©nagement humain."],
          [["Boues", "S√©diments"], "S√©diments = naturel (fond rivi√®re). Boues = issu d'un traitement ou station d'√©puration."],
          [["Aquif√®re", "Aquitard"], "Aquif√®re contient et fait circuler l'eau. Aquitard contient mais freine l'eau (peu perm√©able)."],
          [["Aquiclude", "Aquif√®re"], "Aquiclude bloque l'eau (imperm√©able). Aquif√®re la laisse passer."]
        ]
      },
      moyen: {
        "Hydraulique & circulation": [
          [["Pompage", "Drainage"], "Pompage = actif (moteur). Drainage = passif (gravit√©/tuyaux)."],
          [["√âvaporation", "Volatilisation"], "√âvaporation = Eau -> Vapeur. Volatilisation = Polluant -> Gaz."],
          [["Nappe libre", "Nappe captive"], "Libre = surface √† pression atmosph√©rique. Captive = sous pression sous un toit imperm√©able."],
          [["√âquipotentielle", "Ligne de courant"], "√âquipotentielle = m√™me charge. Ligne de courant = direction de l'eau. Elles sont perpendiculaires."],
          [["Limite perm√©able", "Limite imperm√©able"], "Perm√©able = l'eau rentre/sort (rivi√®re). Imperm√©able = l'eau bute (mur argile)."],
          [["Dispersion", "Diffusion"], "Diffusion = chimique (lent). Dispersion = m√©canique due aux chemins dans le sol (rapide)."]
        ],
        "Polluants & risques": [
          [["Hydrocarbure", "Benz√®ne"], "Benz√®ne est un TYPE d'hydrocarbure (aromatique, canc√©rig√®ne)."],
          [["Toxique", "Biodisponible"], "Toxique = fait mal. Biodisponible = peut entrer dans l'organisme."],
          [["D√©chet", "R√©sidu"], "R√©sidu = reste d'un process. D√©chet = ce qu'on jette (statut juridique)."],
          [["Bact√©rie", "Micro-organisme"], "Micro-organisme est la cat√©gorie globale (inclut virus, champignons...)."],
          [["Engrais", "Pesticide"], "Engrais = Nourriture plante. Pesticide = Poison nuisible."]
        ],
        "Sols & terrain": [
          [["Argile", "Barri√®re"], "L'argile est un mat√©riau. La barri√®re est une fonction (l'argile PEUT faire barri√®re)."],
          [["Sondage", "Carottage"], "Sondage = trou g√©n√©rique. Carottage = on sort un cylindre de terre intact."],
          [["Filtre", "Tamis"], "Tamis = grille grossi√®re. Filtre = maillage fin."]
        ],
        "Chimie": [
          [["Oxydation", "R√©duction"], "Oxydation = perte d'√©lectron. R√©duction = gain d'√©lectron."]
        ]
      },
      difficile: {
        "Hydraulique Expert": [
          [["Perm√©abilit√©", "Transmissivit√©"], "Perm√©abilit√© (K) est une propri√©t√© du sol. Transmissivit√© (T) = K x √âpaisseur de la couche."],
          [["Charge", "Pression"], "Charge = Pression + Altitude (Z). L'eau va de la haute charge vers la basse charge."],
          [["Pore", "Vide"], "Pore = un trou. Vide = le volume total des trous."],
          [["Nappe", "Aquif√®re"], "Aquif√®re = le contenant (roche). Nappe = le contenu (eau)."]
        ],
        "Polluants & Toxicit√©": [
          [["M√©taux lourds", "Plomb"], "Le plomb est un exemple sp√©cifique de m√©tal lourd."]
        ],
        "Techniques Avanc√©es": [
          [["Absorption", "Adsorption"], "Ab-sorption = dedans (√©ponge). Ad-sorption = surface (velcro)."],
          [["Barri√®re r√©active", "Barri√®re perm√©able"], "Toute barri√®re r√©active est perm√©able, mais elle traite l'eau chimiquement au passage."],
          [["Excavation", "Terrassement"], "Excavation = creuser. Terrassement = bouger la terre pour modeler le terrain."]
        ],
        "R√©glementaire": [
          [["Loi", "Arr√™t√©"], "Loi = vot√©e au parlement (cadre). Arr√™t√© = d√©cision administrative (application locale/pr√©fet)."],
          [["Dirichlet", "Neumann"], "Conditions limites mod√®le : Dirichlet impose le niveau (H). Neumann impose le d√©bit (Q)."]
        ],
        "Transfert": [
          [["Cible", "Vecteur"], "Vecteur = transporteur (eau/air). Cible = r√©cepteur (homme/nappe)."]
        ]
      }
    };

    const ROLES = ["Tra√Ætre", "Archiviste", "Lanceur d'alerte", "Juriste", "Maire", "Bin√¥me"];

    function show(id){
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function renderDictionary(){
        const div = document.getElementById('dictionaryContent');
        div.innerHTML = "";
        for(let diff in GAME_DATA){
            let dTitle = document.createElement('div');
            dTitle.className = "dict-category";
            dTitle.innerText = diff;
            div.appendChild(dTitle);

            for(let theme in GAME_DATA[diff]){
                let tTitle = document.createElement('div');
                tTitle.className = "dict-theme";
                tTitle.innerText = theme;
                div.appendChild(tTitle);

                GAME_DATA[diff][theme].forEach(item => {
                    let el = document.createElement('div');
                    el.className = "dict-item";
                    el.innerHTML = `<div class="dict-pair">${item[0][0]} <span style="font-size:0.8em; color:white;">vs</span> ${item[0][1]}</div>
                                    <div class="dict-def">${item[1]}</div>`;
                    div.appendChild(el);
                });
            }
        }
    }

    function updateThemes(){
        let diff = document.getElementById('difficultySelect').value;
        let sel = document.getElementById('themeSelect');
        sel.innerHTML = "";
        for(let t in GAME_DATA[diff]){
            let opt = document.createElement('option');
            opt.value = t; opt.innerText = t;
            sel.appendChild(opt);
        }
    }

    function buildNameInputs(){
        let n = document.getElementById('playerCount').value;
        let d = document.getElementById('namesList');
        d.innerHTML = "";
        for(let i=0; i<n; i++){
            let inp = document.createElement('input');
            inp.placeholder = `Joueur ${i+1}`;
            inp.id = `pname${i}`;
            d.appendChild(inp);
        }
    }

    function populateRoles(){
        let d = document.getElementById('rolesSelect');
        ROLES.forEach(r => {
            let div = document.createElement('div');
            div.className = "role-check";
            div.innerHTML = `<input type="checkbox" value="${r}"> <span>${r}</span>`;
            d.appendChild(div);
        });
    }

    /* LOGIQUE JEU */
    let players = [];
    let sessionContext = "";
    let sessionCiv = "";
    let sessionUnd = "";
    let revealIdx = 0;
    let timerInt = null;
    let publicQueue = [];

    function assignRolesAndWords(){
        let count = document.getElementById('playerCount').value;
        players = [];
        for(let i=0; i<count; i++){
            let nm = document.getElementById(`pname${i}`).value.trim() || `J${i+1}`;
            players.push({name:nm, role:'Analyste', word:null, alive:true});
        }

        let diff = document.getElementById('difficultySelect').value;
        let theme = document.getElementById('themeSelect').value;
        let arr = GAME_DATA[diff][theme];
        let pick = arr[Math.floor(Math.random()*arr.length)];
        let words = pick[0];
        sessionContext = pick[1];

        if(Math.random()>0.5) { sessionCiv=words[0]; sessionUnd=words[1]; }
        else { sessionCiv=words[1]; sessionUnd=words[0]; }

        let idxs = players.map((_,i)=>i).sort(()=>Math.random()-0.5);
        
        let polIdx = idxs.pop();
        players[polIdx].role = "Pollueur";
        players[polIdx].word = sessionUnd;

        if(count > 4 && Math.random() < 0.2){
             let wIdx = idxs.pop();
             players[wIdx].role = "Mister White";
             players[wIdx].word = null;
        }

        let checkboxes = document.querySelectorAll('#rolesSelect input:checked');
        checkboxes.forEach(cb => {
            if(idxs.length > 0){
                let sIdx = idxs.pop();
                players[sIdx].role = cb.value;
            }
        });

        idxs.forEach(i => players[i].role = "Analyste");

        players.forEach(p => {
            if(p.role !== "Pollueur" && p.role !== "Mister White") p.word = sessionCiv;
        });

        publicQueue = players.filter(p => !["Analyste", "Pollueur", "Mister White", "Tra√Ætre"].includes(p.role));
        
        revealIdx = 0;
        updateReveal();
        show('revealScreen');
    }

    function updateReveal(){
        document.getElementById('revealName').innerText = players[revealIdx].name;
        document.getElementById('seeBtn').style.display = 'block';
        document.getElementById('wordInfo').style.display = 'none';
    }

    function seeMyWord(){
        let p = players[revealIdx];
        document.getElementById('seeBtn').style.display = 'none';
        document.getElementById('wordInfo').style.display = 'block';
        
        let wDisplay = document.getElementById('wordDisplay');
        let rDisplay = document.getElementById('roleLabel');

        if(p.role === "Mister White"){
            wDisplay.innerText = "???";
            rDisplay.innerText = "Tu es Mister White";
        } else {
            wDisplay.innerText = p.word;
            if(p.role === "Pollueur") rDisplay.innerText = "Tu es l'Infiltr√© (Pollueur)";
            else rDisplay.innerText = `Tu es Civil (${p.role})`;
        }
    }

    function nextReveal(){
        revealIdx++;
        if(revealIdx >= players.length){
            startDiscussion();
            show('discussionScreen');
        } else {
            updateReveal();
        }
    }

    function startDiscussion(){
        document.getElementById('votingArea').style.display = 'none';
        
        let ban = document.getElementById('publicRoleBanner');
        if(publicQueue.length > 0){
            let rev = publicQueue.pop(); 
            ban.style.display = 'block';
            ban.innerText = `üì¢ INFO : ${rev.name} est ${rev.role}`;
        } else {
            ban.style.display = 'none';
        }

        if(timerInt) clearInterval(timerInt);
        let t = 90;
        document.getElementById('timerDisplay').innerText = "01:30";
        timerInt = setInterval(() => {
            t--;
            let m = Math.floor(t/60);
            let s = t%60;
            document.getElementById('timerDisplay').innerText = `0${m}:${s<10?'0'+s:s}`;
            if(t<=0) clearInterval(timerInt);
        }, 1000);
    }

    function openVoting(){
        clearInterval(timerInt);
        document.getElementById('votingArea').style.display = 'block';
        let d = document.getElementById('voteList');
        d.innerHTML = "";
        players.forEach((p,i) => {
            if(p.alive){
                let item = document.createElement('div');
                item.className = "vote-item";
                item.innerHTML = `<span>${p.name}</span>`;
                item.onclick = function(){
                    document.querySelectorAll('.vote-item').forEach(x=>x.classList.remove('selected'));
                    item.classList.add('selected');
                    item.dataset.idx = i;
                }
                d.appendChild(item);
            }
        });
    }

    function collectVotes(){
        let sel = document.querySelector('.vote-item.selected');
        if(!sel) return alert("S√©lectionnez un joueur !");
        
        let idx = sel.dataset.idx;
        let p = players[idx];
        p.alive = false;

        let msg = `<strong>${p.name}</strong> est √©limin√©.<br>Il √©tait : <strong>${p.role}</strong><br>Mot : ${p.word||"Aucun"}`;
        document.getElementById('afterContent').innerHTML = msg;

        let alives = players.filter(x=>x.alive);
        let pol = alives.find(x=>x.role==="Pollueur");

        if(!pol){ 
            finish("VICTOIRE CIVILS", "Le Pollueur a √©t√© √©limin√© !");
        } else if(alives.length <= 2){ 
            finish("VICTOIRE POLLUEUR", "Il a surv√©cu jusqu'au duel final.");
        } else {
            show('afterScreen');
        }
    }

    function proceedAfterVote(){
        startDiscussion();
        show('discussionScreen');
    }

    function forceFinalReveal(){
        finish("PARTIE ARR√äT√âE", "R√©v√©lation forc√©e.");
    }

    function finish(titre, desc){
        document.getElementById('endMessage').innerText = `${titre} - ${desc}`;
        document.getElementById('endContext').innerText = sessionContext;
        
        let ul = document.getElementById('playersSummary');
        ul.innerHTML = "";
        players.forEach(p => {
            let li = document.createElement('li');
            li.innerHTML = `${p.name} : ${p.role} (${p.word||"√ò"})`;
            ul.appendChild(li);
        });
        show('endScreen');
    }
  </script>
</body>
</html>
